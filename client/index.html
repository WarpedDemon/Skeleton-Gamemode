<html>
	<head>
		<!--<audio id="backgroundMusic" src="/client/music/backgroundMusic.mp3"></audio>!-->
		<!-- assets -->
		<link rel="stylesheet" type="text/css" href="/client/css/index.css"/>
		<link rel="stylesheet" type="text/css" href="/client/css/font-awesome.min.css" />
		<title> Skeleton Gamemode </title>
		<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
		<script src="client/js/anime.min.js"></script>
		<div id="Hotbar">
			<ul id="HotbarList">

			</ul>

		</div>
		<!--knightAttack1-->
		<img src="client/img/Gui/Hotbar.png" id="HotbarImg" style="display: block;"/>

		<img src="client/img/gameTiles/middleRoomPillar.png" id="internal_wall" style="display: none;"/>

		<img src="client/img/gameTiles/wallPillar1.png" id="room_pillar1" style="display: none;"/>
		<img src="client/img/gameTiles/wallPillar2.png" id="room_pillar2" style="display: none;"/>

		<img src="client/img/gameTiles/blank.png" id="blank" style="display: none;"/>

		<img src="client/img/gameTiles/tiledFloor.png" id="tiled_floor" style="display: none;"/>

		<img src="client/img/gameTiles/outRightBottomCorner.png" id="out_bottom_right_corner" style="display: none;"/>
		<img src="client/img/gameTiles/outLeftBottomCorner.png" id="out_bottom_left_corner" style="display: none;"/>
		<img src="client/img/gameTiles/outRightTopCorner.png" id="out_top_right_corner" style="display: none;"/>
		<img src="client/img/gameTiles/outLeftTopCorner.png" id="out_top_left_corner" style="display: none;"/>

		<img src="client/img/gameTiles/bottomRightCorner.png" id="bottom_right_corner" style="display: none;"/>
		<img src="client/img/gameTiles/bottomLeftCorner.png" id="bottom_left_corner" style="display: none;"/>
		<img src="client/img/gameTiles/topRightCorner.png" id="top_right_corner" style="display: none;"/>
		<img src="client/img/gameTiles/topLeftCorner.png" id="top_left_corner" style="display: none;"/>

		<img src="client/img/gameTiles/chest.png" id="chest" style="display: none;"/>

		<img src="client/img/gameTiles/BottomWall.png" id="wall_bottom" style="display: none;"/>
		<img src="client/img/gameTiles/wall.png" id="wall_top" style="display: none;"/>
		<img src="client/img/gameTiles/wallLeft.png" id="wall_left" style="display: none;"/>
		<img src="client/img/gameTiles/wallRight.png" id="wall_right" style="display: none;"/>

		<img src="client/img/Character/idle1.png" id="player_idle1" style="display: none;"/>
		<img src="client/img/Character/idle2.png" id="player_idle2" style="display: none;"/>
		<img src="client/img/Character/idle3.png" id="player_idle3" style="display: none;"/>

		<img src="client/img/Character/ghost.png" id="ghost_idle1" style="display: none;"/>
		<img src="client/img/Character/ghost2.png" id="ghost_idle2" style="display: none;"/>
		<img src="client/img/Character/ghost3.png" id="ghost_idle3" style="display: none;"/>
		<img src="client/img/Character/ghost4.png" id="ghost_idle4" style="display: none;"/>
		<img src="client/img/Character/ghost5.png" id="ghost_idle5" style="display: none;"/>
		<img src="client/img/Character/ghost6.png" id="ghost_idle6" style="display: none;"/>
		<img src="client/img/Character/ghost7.png" id="ghost_idle7" style="display: none;"/>
		<img src="client/img/Character/ghost8.png" id="ghost_idle8" style="display: none;"/>
		<img src="client/img/Character/ghost9.png" id="ghost_idle9" style="display: none;"/>

		<img src="client/img/Character/run1.png" id="player_run1" style="display: none;"/>
		<img src="client/img/Character/run2.png" id="player_run2" style="display: none;"/>
		<img src="client/img/Character/run3.png" id="player_run3" style="display: none;"/>
		<img src="client/img/Character/run4.png" id="player_run4" style="display: none;"/>
		<img src="client/img/Character/run5.png" id="player_run5" style="display: none;"/>
		<img src="client/img/Character/run6.png" id="player_run6" style="display: none;"/>

		<img src="client/img/Character/idle_left1.png" id="player_idle_left1" style="display: none;"/>
		<img src="client/img/Character/idle_left2.png" id="player_idle_left2" style="display: none;"/>
		<img src="client/img/Character/idle_left3.png" id="player_idle_left3" style="display: none;"/>

		<img src="client/img/Character/run_left1.png" id="player_run_left1" style="display: none;"/>
		<img src="client/img/Character/run_left2.png" id="player_run_left2" style="display: none;"/>
		<img src="client/img/Character/run_left3.png" id="player_run_left3" style="display: none;"/>
		<img src="client/img/Character/run_left4.png" id="player_run_left4" style="display: none;"/>
		<img src="client/img/Character/run_left5.png" id="player_run_left5" style="display: none;"/>
		<img src="client/img/Character/run_left6.png" id="player_run_left6" style="display: none;"/>

		<img src="client/img/Character/up1.png" id="player_up1" style="display: none;"/>
		<img src="client/img/Character/up2.png" id="player_up2" style="display: none;"/>
		<img src="client/img/Character/up3.png" id="player_up3" style="display: none;"/>
		<img src="client/img/Character/up4.png" id="player_up4" style="display: none;"/>

		<img src="client/img/Character/down1.png" id="player_down1" style="display: none;"/>
		<img src="client/img/Character/down2.png" id="player_down2" style="display: none;"/>
		<img src="client/img/Character/down3.png" id="player_down3" style="display: none;"/>
		<img src="client/img/Character/down4.png" id="player_down4" style="display: none;"/>

		<img src="client/img/Character/attack_up1.png" id="player_attack_up1" style="display: none;" />
		<img src="client/img/Character/attack_up2.png" id="player_attack_up2" style="display: none;" />
		<img src="client/img/Character/attack_up3.png" id="player_attack_up3" style="display: none;" />
		<img src="client/img/Character/attack_up4.png" id="player_attack_up4" style="display: none;" />

		<img src="client/img/Character/attack_right1.png" id="player_attack_right1" style="display: none;" />
		<img src="client/img/Character/attack_right2.png" id="player_attack_right2" style="display: none;" />
		<img src="client/img/Character/attack_right3.png" id="player_attack_right3" style="display: none;" />
		<img src="client/img/Character/attack_right4.png" id="player_attack_right4" style="display: none;" />

		<img src="client/img/Character/attack_left1.png" id="player_attack_left1" style="display: none;" />
		<img src="client/img/Character/attack_left2.png" id="player_attack_left2" style="display: none;" />
		<img src="client/img/Character/attack_left3.png" id="player_attack_left3" style="display: none;" />
		<img src="client/img/Character/attack_left4.png" id="player_attack_left4" style="display: none;" />

		<img src="client/img/Character/attack_down1.png" id="player_attack_down1" style="display: none;" />
		<img src="client/img/Character/attack_down2.png" id="player_attack_down2" style="display: none;" />
		<img src="client/img/Character/attack_down3.png" id="player_attack_down3" style="display: none;" />
		<img src="client/img/Character/attack_down4.png" id="player_attack_down4" style="display: none;" />

		<!--Knights-->
		<img src="client/img/Character/knightRight1.png" id="knightRight1" style="display:none;" />
		<img src="client/img/Character/knightRight2.png" id="knightRight2" style="display:none;" />
		<img src="client/img/Character/knightRight3.png" id="knightRight3" style="display:none;" />
		<img src="client/img/Character/knightLeft1.png" id="knightLeft1" style="display:none;" />
		<img src="client/img/Character/knightLeft2.png" id="knightLeft2" style="display:none;" />
		<img src="client/img/Character/knightLeft3.png" id="knightLeft3" style="display:none;" />
		<img src="client/img/Character/knightUp1.png" id="knightUp1" style="display:none;" />
		<img src="client/img/Character/knightUp2.png" id="knightUp2" style="display:none;" />
		<img src="client/img/Character/knightUp3.png" id="knightUp3" style="display:none;" />
		<img src="client/img/Character/knightDown1.png" id="knightDown1" style="display:none;" />
		<img src="client/img/Character/knightDown2.png" id="knightDown2" style="display:none;" />
		<img src="client/img/Character/knightDown3.png" id="knightDown3" style="display:none;" />

		<!--Knights attacksz-->
		<img src="client/img/Abilities/knightAttack/knightAttack1.png" id="knightAttack1" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack2.png" id="knightAttack2" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack3.png" id="knightAttack3" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack4.png" id="knightAttack4" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack5.png" id="knightAttack5" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack6.png" id="knightAttack6" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack7.png" id="knightAttack7" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack8.png" id="knightAttack8" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack9.png" id="knightAttack9" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack10.png" id="knightAttack10" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack11.png" id="knightAttack11" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack12.png" id="knightAttack12" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack13.png" id="knightAttack13" style="display: none;"/>
		<img src="client/img/Abilities/knightAttack/knightAttack14.png" id="knightAttack14" style="display: none;"/>

		<img src="client/img/Abilities/knightAttack/knightAttackStack.png" id="knightAttackStack" style="display: none;"/>

		<img src="client/img/Abilities/knightAttack/knightAttackExecute.png" id="knightAttackExecute" style="display: none;"/>


		<img src="client/img/Character/ratDown.png" id="rat_down" style="display: none;"/>
		<img src="client/img/Character/ratUp.png" id="rat_up" style="display: none;"/>
		<img src="client/img/Character/ratLeft.png" id="rat_left" style="display: none;"/>
		<img src="client/img/Character/ratRight.png" id="rat_right" style="display: none;"/>

		<img src="client/img/Abilities/Melee_Default/Melee_Default_Right1.png" id="melee_default_Right1" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Right2.png" id="melee_default_Right2" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Right3.png" id="melee_default_Right3" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Right4.png" id="melee_default_Right4" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Right5.png" id="melee_default_Right5" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Right6.png" id="melee_default_Right6" style="display: none;"/>


		<img src="client/img/Abilities/Melee_Default/Melee_Default_Left1.png" id="melee_default_Left1" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Left2.png" id="melee_default_Left2" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Left3.png" id="melee_default_Left3" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Left4.png" id="melee_default_Left4" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Left5.png" id="melee_default_Left5" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Left6.png" id="melee_default_Left6" style="display: none;"/>


		<img src="client/img/Abilities/Melee_Default/Melee_Default_Up1.png" id="melee_default_Up1" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Up2.png" id="melee_default_Up2" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Up3.png" id="melee_default_Up3" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Up4.png" id="melee_default_Up4" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Up5.png" id="melee_default_Up5" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Up6.png" id="melee_default_Up6" style="display: none;"/>


		<img src="client/img/Abilities/Melee_Default/Melee_Default_Down1.png" id="melee_default_Down1" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Down2.png" id="melee_default_Down2" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Down3.png" id="melee_default_Down3" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Down4.png" id="melee_default_Down4" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Down5.png" id="melee_default_Down5" style="display: none;"/>
		<img src="client/img/Abilities/Melee_Default/Melee_Default_Down6.png" id="melee_default_Down6" style="display: none;"/>

		<!--ABILITIES-->
		<img src="client/img/Abilities/dust_mites/dust_mites_1.png" id="dust_mites_1" style="display: none;" />
		<img src="client/img/Abilities/dust_mites/dust_mites_2.png" id="dust_mites_2" style="display: none;" />
		<img src="client/img/Abilities/dust_mites/dust_mites_3.png" id="dust_mites_3" style="display: none;" />
		<img src="client/img/Abilities/dust_mites/dust_mites_4.png" id="dust_mites_4" style="display: none;" />
		<img src="client/img/Abilities/dust_mites/dust_mites_5.png" id="dust_mites_5" style="display: none;" />
		<img src="client/img/Abilities/dust_mites/dust_mites_6.png" id="dust_mites_6" style="display: none;" />
		<img src="client/img/Abilities/dust_mites/dust_mites_7.png" id="dust_mites_7" style="display: none;" />

		<script src="client/js/PathFinding.js"></script>
		<script src="client/js/jquery.min.js"> </script>
	</head>

 	<!-- overflays e.g. modals or menu -->
	<body>
		<div id="menuOverlay">
			<div id="menuClose"><span id="menuCloseSpan" class="fa fa-times"></span> <span id="menuCloseText">Close</span></div>
			<div id="menuDefault">
				<h1> Menu </h1>
				<hr/>
				<ul class="menuOptions">
					<li id="inventoryButton"><img src="client/img/gfx/inventory.png" width="64" height="64" /><p>Inventory</p></li>
					<li id="multiplayerButton"><img src="client/img/gfx/multiplayer.png" width="64" height="64" /><p>Multiplayer</p></li>
					<li id="spellBookButton"><img src="client/img/gfx/book.png" width="64" height="64" /><p>Spell Book</p></li>
				</ul>
			</div>


			<div id="menuSpellBook">
				<h1> Spell Book </h1>
				<hr/>
				<ul id="menuSpellBookList">
					<!--Automatically Generated Items here-->
				</ul>
			</div>

			<div id="menuMultiplayer">
				<h1>Multiplayer</h1>
				<hr/>
				<ul class="menuOptions">
					<li id="invadeButton"><img src="client/img/gfx/invade.png" width="64" height="64" /><p>Invade</p></li>
					<li id="joinButton"><img src="client/img/gfx/joinFriend.png" width="64" height="64" /><p>Join a Friend</p></li>
					<li id="menuHostButton"><img src="client/img/gfx/host.png" width="64" height="64" /><p>Host</p></li>
				</ul>
			</div>

			<div id="menuHost">
				<h1> Host</h1>
				<hr/>
				<br/>
				<h4 style="margin-top: -10px;">Allow others to join:</h4>
				<label class="switch">
				  <input type="checkbox" id="multiplayerCheckbox">
				  <div class="slider round"></div>
				</label>
				<h3> Your World Id</h3>

				<div id="menuHostId">NOT ACTIVE</div>
			</div>

			<div id="menuInventory">
				<h1> Inventory </h1>
				<hr/>
				<ul id="menuInventoryList">
					<!--Automatically Generated Items here-->
				</ul>
			</div>

			<div id="menuJoin">
				<h1> Join </h1>
				<hr/>
				<br/>
				<h4>Enter World ID: </h4>
				<input id="menuJoinId" type="text" />
				<div id="menuJoinButton"><span class=""></span> Join</div>
			</div>

		</div>



		<div id="menuButton">
			<span class="fa fa-bars fa-2x menuButtonSpan"></span>
		</div>

		<!--LOGIN OVERLAY
		=================-->

		<div id="loginOverlay">
			<h1> Login </h1>
			<hr/>
			<br/>
			Username: <input type="text" id="username_input" placeholder="Username..." />
			<br/>
			<br/>
			Password: <input type="password" id="password_input" placeholder="Password..." />
			<br/>
			<br/>
			<br/>
			<a href="#" id="loginSubmit"><p><b>Login</b></p></a>
			<a href="#" id="registerSwitchButton"><p><b>Create Account</b></p></a>
		</div>


		<!--WORLD SWITCHER OVERLAY
		==========================-->

		<div id="worldSwitchOverlay">
			<h2> Available Worlds </h2>
			<hr/>
			<ul id="lobbyList">
				<!--Automatically generated items here-->

			</ul>
			<hr/>
			<div id="lobbyRefresh"><p>Refresh</p></div>
		</div>



		<!--SHOP OVERLAY
		==================-->
		<div id="shopOverlay">
			<div class="tab">
			  <button class="tablinks" onclick="shop_switchTo(event, 'Weapons')">Weapons</button>
			  <button class="tablinks" onclick="shop_switchTo(event, 'Defence')">Defence</button>
			  <button class="tablinks" onclick="shop_switchTo(event, 'Magic')">Magic</button>
			</div>

			<div id="Weapons" class="tabcontent">
			  <h1>Weapons</h1>
				<hr/>
			  <p>Sword</p>
			</div>

			<div id="Defence" class="tabcontent">
			  <h1>Defence</h1>
				<hr/>
			  <p>Sheild</p>
			</div>

			<div id="Magic" class="tabcontent">
			  <h1>Magic</h1>
				<hr/>
				<ul id="spellList">
			  	<p>Mana Bolt</p>
				</ul>
			</div>
		</div>


		<!-- GUI ELEMENTS ONLY -->
		<img id="healthGui" class="unselectable" alt="healthGui.png" src="client/img/gui/Gui_Health.png" />
		<img id="healthGuiEnemy" class="unselectable" alt="healthGuiEnemy.png" src="client/img/gui/Gui_Health_Enemy.png" />

		<!-- END GUI -->

		<h1 id="title"></h1>
		<div id="canvasBacking">
			<canvas id="ctx" width="1000" height="1000" style="border: 1px solid #000000;"></canvas>
		</div>
		<script>
			//run client.js
			//wall resources
			//global variables
			var testTurn = 0;
			var offset = (Math.PI/180)*90;
			var interval;
			var dt = 0;

			var canvas = document.getElementById('ctx')
			var ctx = canvas.getContext('2d');
			ctx.font = '30px Arial';

			var WIDTH = canvas.width;
			var HEIGHT = canvas.height;

			var socket = io();

			var localOffsetx;
			var localOffsetY;
			var localId;
			var localData;

			var mouseX, mouseY;

			var lockW = lockA = lockS = lockD = false; //here because networking aka matt is responcible for this.

			var local_MAP_ARRAY;

			var gameDimensionX;
			var gameDimensionY;
			//Gui
			var healthGui, healthGuiEnemy;
			var hotbar, hotbarImg;

			var hovering = ["none", 0];

			//TILES

			var dungeon_tiled_floor, blank, dungeon_top_left_corner, dungeon_top_right_corner, dungeon_bottom_left,
					dungeon_out_top_left_corner, dungeon_out_top_right_corner, dungeon_out_bottom_left_corner, dungeon_out_bottom_right_corner,
					dungeon_bottom_right, dungeon_wall_top, dungeon_wall_bottom, dungeon_wall_right, dungeon_wall_left, dungeon_internal_wall, dungeon_room_pillar1, dungeon_room_pillar2, dungeon_chest;



			var ghost_1, ghost_2, ghost_3, ghost_4, ghost_5, ghost_6, ghost_7, ghost_8, ghost_9;

			//Melee Attack Sprite Variable Allocations.
			var melee_default_right1, melee_default_right2, melee_default_right3, melee_default_right4, melee_default_right5, melee_default_right6,
					melee_default_left1, melee_default_left2, melee_default_left3, melee_default_left4, melee_default_left5, melee_default_left6,
					melee_default_up1, melee_default_up2, melee_default_up3, melee_default_up4, melee_default_up5, melee_default_up6,
					melee_default_down1, melee_default_down2, melee_default_down3, melee_default_down4, melee_default_down5, melee_default_down6;
			var melee_animations;

			//Ability Sprite Variable Allocations.
			var dust_mites_1, dust_mites_2, dust_mites_3, dust_mites_4, dust_mites_5, dust_mites_6, dust_mites_7;
			var AbilityAnims = {
				dust_mites: []
			}

			//Player Sprite Variable Allocations.
			var player_idle1, player_ide2, player_idle3;
			var player_run1, player_run2, player_run3, player_run4, player_run5, player_run6;
			var player_up1, player_up2, player_up3, player_up4;
			var player_down1, player_down2, player_down3, player_down4;
			var player_idle_left1;
			var player_idle_left1, player_idle_left2, player_idle_left3;
			var player_attack_left1, player_attack_left2, player_attack_left3, player_attack_left4,
			  	player_attack_right1, player_attack_right2, player_attack_right3, player_attack_right4,
		  		player_attack_up1, player_attack_up2, player_attack_up3, player_attack_up4,
					player_attack_down1, player_attack_down2, player_attack_down3, player_attack_down4;
			var player_run_left1, player_run_left2, player_run_left3, player_run_left4, player_run_left5, player_run_left6;
			var player_animations;
			//knights
			var knightDown1,knightDown2,knightDown3,knightUp1,knightUp2,knightUp3,knightLeft1,knightLeft2,knightLeft3,knightRight1,knightRight2,knightRight3;
			var knightAttack1,knightAttack2,knightAttack3,knightAttack4,knightAttack5,knightAttack6,knightAttack7,knightAttack8,knightAttack9,knightAttack10,
					knightAttack11, knightAttack12,knightAttack13,knightAttack14,knightAttackStack,knightAttackExecute;
			var knightAnims = {};
			//Rats
			var rat_up, rat_down, rat_left, rat_right;
			var ratAnims = {};

			var local_KNIGHT_ARRAY = [];
			var local_GHOST_ARRAY = [];
			var local_RAT_ARRAY = [];		//number of an object
			var local_ATTACK_ARRAY = [];
			var local_KNIGHT_ATTACK_ARRAY = [];
			var local_ABILITIES_ARRAY = [];
			var local_PLAYER_LIST = [];

			var loginButton, registerSwitchButton, loginOverlay, username_input, password_input;
			var lobbyOverlay, lobbyRefresh, lobbyList;
			//menus
			var menuOverlay, menuButton, menuDefault, menuMultiplayer, inventoryButton, multiplayerButton, menuClose, menuCloseText, menuCloseSpan, menuSpellBookList;
			var multiplayerCheckbox, menuHost, menuHostId, menuHostButton, menuJoin, menuJoinId, menuJoinButton, joinButton, spellBookButton, menuSpellBook;

			var menuToggled = false;
			var DungeonTiles = {};
			///Interactions
			var shopOverlay;
			var displayingShop = false;


			var grdHealth=ctx.createLinearGradient(90,13,160,13);
			grdHealth.addColorStop(0,"#8A0707");
			grdHealth.addColorStop(1,"red");

			var grdMana=ctx.createLinearGradient(90,29,160,13);
			grdMana.addColorStop(0,"blue");
			grdMana.addColorStop(1,"#1bdbe5");


			var Hovers = {
				//aer
				roaring_thunder: {
					type: "radial",
					r: 16
				},
				dust_mites: {
					type: "radial",
					r: 16
				},
				//tenebrae
				soul_passage: {
					type: "radial",
					r: 32
				}
			};

			var shopSpellList = {
				manaBolt: {
					name: "Mana Bolt",
					cost: 50,
					manaCost: 5
				},
				fireBolt: {
					name: "Fire bolt",
					cost: 50,
					manaCost: 5
				},
				lightBolt: {
					name: "Lightning bolt",
					cost: 100,
					manaCost: 10
				}
			}
			canvas.addEventListener('mousemove', onMouseMove, false);
			var interacting = {
				ShopKeeper: false //events overlay
			}

			function onMouseMove(e) {
				var rect = canvas.getBoundingClientRect();

        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;
				console.log(mouseX + localData.x - (WIDTH/2), mouseY + localData.y - (HEIGHT/2))
				hovering = ["none", 0];
				for(var i in local_RAT_ARRAY) {
					var rat = local_RAT_ARRAY[i];
					if(boxCollides([mouseX - localData.x + (WIDTH/2) - 5,mouseY - localData.y + (HEIGHT/2) - 5],[10,10],[rat.x-rat.size/2,rat.y-rat.size/2],[rat.size,rat.size])) {
						hovering = ["rat",i];
						console.log("now hovering!");
					}
				}



			}

			function start() {
				//Gui
				hotbar = document.getElementById("Hotbar");
				hotbarImg = document.getElementById('HotbarImg');
				hotbarImg.style.display = "none";

				healthGui = document.getElementById('healthGui');
				healthGuiEnemy = document.getElementById('healthGuiEnemy');

				//starts all of the assets
				shopOverlay = document.getElementById("shopOverlay");
				console.log("SET SHOP OVERLAY");

				loginButton = document.getElementById('loginSubmit');
				registerSwitchButton = document.getElementById('registerSwitchButton');
				username_input = document.getElementById('username_input');
				password_input = document.getElementById('password_input');
				loginOverlay = document.getElementById('loginOverlay');


				loginButton.addEventListener('click', attemptLogin, false);



				lobbyOverlay = document.getElementById('lobbyOverlay');
				lobbyRefresh = document.getElementById('lobbyRefresh');
				lobbyList = document.getElementById('lobbyList');

				lobbyRefresh.addEventListener('click', refreshLobbyList, false);


				menuOverlay = document.getElementById('menuOverlay');
				menuButton = document.getElementById('menuButton');
				menuMultiplayer = document.getElementById('menuMultiplayer');
				menuDefault = document.getElementById('menuDefault');
				menuClose = document.getElementById('menuClose');
				menuCloseText = document.getElementById('menuCloseText');
				menuCloseSpan = document.getElementById('menuCloseSpan');
				multiplayerButton = document.getElementById('multiplayerButton');
				inventoryButton = document.getElementById('inventoryButton');
				joinButton = document.getElementById('joinButton');
				spellBookButton = document.getElementById('spellBookButton');
        menuSpellBook = document.getElementById('menuSpellBook');
				menuSpellBookList = document.getElementById('menuSpellBookList');

				joinButton.addEventListener('click', showJoin, false);

				spellBookButton.addEventListener('click', showSpells, false);

				menuHost = document.getElementById('menuHost');
				multiplayerCheckbox = document.getElementById('multiplayerCheckbox');
				menuHostButton = document.getElementById('menuHostButton');

				menuJoin = document.getElementById('menuJoin');
				menuJoinId = document.getElementById('menuJoinId');
				menuJoinButton = document.getElementById('menuJoinbutton');

				//menuJoinButton.addEventListener('click', joinWorld, false);

				menuHostButton.addEventListener('click', showHost, false);

				multiplayerCheckbox.onchange = function() {
					if(this.checked) {
						activateMultiplayer();
					} else {
						deactivateMultiplayer();
					}
				}

				multiplayerButton.addEventListener('click', showMultiplayer, false);

				inventoryButton.addEventListener('click', prepInventory, false);
				menuClose.addEventListener('click', toggleMenu, false);

				menuButton.addEventListener('click', toggleMenu, false);

				//TILES
				dungeon_internal_wall = document.getElementById('internal_wall');

				dungeon_room_pillar1 = document.getElementById('room_pillar1');
				dungeon_room_pillar2 = document.getElementById('room_pillar2');

				dungeon_tiled_floor = document.getElementById('tiled_floor');
				blank = document.getElementById('blank');

				dungeon_top_left_corner = document.getElementById('top_left_corner');
				dungeon_top_right_corner = document.getElementById('top_right_corner');
				dungeon_bottom_left_corner = document.getElementById('bottom_left_corner');
				dungeon_bottom_right_corner = document.getElementById('bottom_right_corner');

				dungeon_out_top_left_corner = document.getElementById('out_top_left_corner');
				dungeon_out_top_right_corner = document.getElementById('out_top_right_corner');
				dungeon_out_bottom_left_corner = document.getElementById('out_bottom_left_corner');
				dungeon_out_bottom_right_corner = document.getElementById('out_bottom_right_corner');

				dungeon_wall_top = document.getElementById('wall_top');
				dungeon_wall_bottom = document.getElementById('wall_bottom');
				dungeon_wall_right = document.getElementById('wall_right');
				dungeon_wall_left = document.getElementById('wall_left');

				chest = document.getElementById('chest');

				DungeonTiles = {
					tiled_floor: {
						src: dungeon_tiled_floor
					},
					internal_wall: {
						src: dungeon_internal_wall
					},
					room_pillar1: {
						src: dungeon_room_pillar1
					},
					room_pillar2: {
						src: dungeon_room_pillar2
					},
					wall_top: {
						src: dungeon_wall_top
					},
					wall_bottom: {
						src: dungeon_wall_bottom
					},
					wall_left: {
						src: dungeon_wall_left
					},
					wall_right: {
						src: dungeon_wall_right
					},

					top_left_corner: {
						src: dungeon_top_left_corner
					},
					top_right_corner: {
						src: dungeon_top_right_corner
					},
					bottom_left_corner: {
						src: dungeon_bottom_left_corner
					},
					bottom_right_corner: {
						src: dungeon_bottom_right_corner
					},

					out_top_left_corner: {
						src: dungeon_out_top_left_corner
					},
					out_top_right_corner: {
						src: dungeon_out_top_right_corner
					},
					out_bottom_left_corner: {
						src: dungeon_out_bottom_left_corner
					},
					out_bottom_right_corner: {
						src: dungeon_out_bottom_right_corner
					},

					chest: {
						src: dungeon_chest
					},

					blank: {
						src: blank
					}
				};




				player_idle_left1 = document.getElementById("player_idle_left1");
				player_idle_left2 = document.getElementById("player_idle_left2");
				player_idle_left3 = document.getElementById("player_idle_left3");

				player_run_left1 = document.getElementById('player_run_left1');
				player_run_left2 = document.getElementById('player_run_left2');
				player_run_left3 = document.getElementById('player_run_left3');
				player_run_left4 = document.getElementById('player_run_left4');
				player_run_left5 = document.getElementById('player_run_left5');
				player_run_left6 = document.getElementById('player_run_left6');

				player_idle1 = document.getElementById("player_idle1");
				player_idle2 = document.getElementById("player_idle2");
				player_idle3 = document.getElementById("player_idle3");

				player_run1 = document.getElementById('player_run1');
				player_run2 = document.getElementById('player_run2');
				player_run3 = document.getElementById('player_run3');
				player_run4 = document.getElementById('player_run4');
				player_run5 = document.getElementById('player_run5');
				player_run6 = document.getElementById('player_run6');

				player_up1 = document.getElementById('player_up1');
				player_up2 = document.getElementById('player_up2');
				player_up3 = document.getElementById('player_up3');
				player_up4 = document.getElementById('player_up4');

				player_down1 = document.getElementById('player_down1');
				player_down2 = document.getElementById('player_down2');
				player_down3 = document.getElementById('player_down3');
				player_down4 = document.getElementById('player_down4');

				player_attack_right1 = document.getElementById('player_attack_right1');
				player_attack_right2 = document.getElementById('player_attack_right2');
				player_attack_right3 = document.getElementById('player_attack_right3');
				player_attack_right4 = document.getElementById('player_attack_right4');



				player_attack_left1 = document.getElementById('player_attack_left1');
				player_attack_left2 = document.getElementById('player_attack_left2');
				player_attack_left3 = document.getElementById('player_attack_left3');
				player_attack_left4 = document.getElementById('player_attack_left4');


				player_attack_down1 = document.getElementById('player_attack_down1');
				player_attack_down2 = document.getElementById('player_attack_down2');
				player_attack_down3 = document.getElementById('player_attack_down3');
				player_attack_down4 = document.getElementById('player_attack_down4');



				player_attack_up1 = document.getElementById('player_attack_up1');
				player_attack_up2 = document.getElementById('player_attack_up2');
				player_attack_up3 = document.getElementById('player_attack_up3');
				player_attack_up4 = document.getElementById('player_attack_up4');


				//Melee Attack designations.

				melee_default_right1 = document.getElementById('melee_default_Right1');
				melee_default_right2 = document.getElementById('melee_default_Right2');
				melee_default_right3 = document.getElementById('melee_default_Right3');
				melee_default_right4 = document.getElementById('melee_default_Right4');
				melee_default_right5 = document.getElementById('melee_default_Right5');
				melee_default_right6 = document.getElementById('melee_default_Right6');


				melee_default_left1 = document.getElementById('melee_default_Left1');
				melee_default_left2 = document.getElementById('melee_default_Left2');
				melee_default_left3 = document.getElementById('melee_default_Left3');
				melee_default_left4 = document.getElementById('melee_default_Left4');
				melee_default_left5 = document.getElementById('melee_default_Left5');
				melee_default_left6 = document.getElementById('melee_default_Left6');


				melee_default_up1 = document.getElementById('melee_default_Up1');
				melee_default_up2 = document.getElementById('melee_default_Up2');
				melee_default_up3 = document.getElementById('melee_default_Up3');
				melee_default_up4 = document.getElementById('melee_default_Up4');
				melee_default_up5 = document.getElementById('melee_default_Up5');
				melee_default_up6 = document.getElementById('melee_default_Up6');


				melee_default_down1 = document.getElementById('melee_default_Down1');
				melee_default_down2 = document.getElementById('melee_default_Down2');
				melee_default_down3 = document.getElementById('melee_default_Down3');
				melee_default_down4 = document.getElementById('melee_default_Down4');
				melee_default_down5 = document.getElementById('melee_default_Down5');
				melee_default_down6 = document.getElementById('melee_default_Down6');

				//Knight attacks
				knightAttack1 = document.getElementById('knightAttack1');
				knightAttack2 = document.getElementById('knightAttack2');
				knightAttack3 = document.getElementById('knightAttack3');
				knightAttack4 = document.getElementById('knightAttack4');
				knightAttack5 = document.getElementById('knightAttack5');
				knightAttack6 = document.getElementById('knightAttack6');
				knightAttack7 = document.getElementById('knightAttack7');
				knightAttack8 = document.getElementById('knightAttack8');
				knightAttack9 = document.getElementById('knightAttack9');
				knightAttack10 = document.getElementById('knightAttack10');
				knightAttack11 = document.getElementById('knightAttack11');
				knightAttack12 = document.getElementById('knightAttack12');
				knightAttack13 = document.getElementById('knightAttack13');
				knightAttack14 = document.getElementById('knightAttack14');
				knightAttackStack = document.getElementById('knightAttackStack');
				knightAttackExecute = document.getElementById('knightAttackExecute');

				//abilities
				dust_mites_1 = document.getElementById('dust_mites_1');
				dust_mites_2 = document.getElementById('dust_mites_2');
				dust_mites_3 = document.getElementById('dust_mites_3');
				dust_mites_4 = document.getElementById('dust_mites_4');
				dust_mites_5 = document.getElementById('dust_mites_5');
				dust_mites_6 = document.getElementById('dust_mites_6');
				dust_mites_7 = document.getElementById('dust_mites_7');

				AbilityAnims.dust_mites = [dust_mites_1, dust_mites_2, dust_mites_3, dust_mites_4, dust_mites_5, dust_mites_6, dust_mites_7];

				knightDown1 = document.getElementById('knightDown1');
				knightDown2 = document.getElementById('knightDown2');
				knightDown3 = document.getElementById('knightDown3');
				knightUp1 = document.getElementById('knightUp1');
				knightUp2 = document.getElementById('knightUp2');
				knightUp3 = document.getElementById('knightUp3');
				knightLeft1 = document.getElementById('knightLeft1');
				knightLeft2 = document.getElementById('knightLeft2');
				knightLeft3 = document.getElementById('knightLeft3');
				knightRight1 = document.getElementById('knightRight1');
				knightRight2 = document.getElementById('knightRight2');
				knightRight3 = document.getElementById('knightRight3');

				rat_down = document.getElementById('rat_down');
				rat_up = document.getElementById('rat_up');
				rat_left = document.getElementById('rat_left');
				rat_right = document.getElementById('rat_right');
				ghost_1 = document.getElementById('ghost_idle1');
				ghost_2 = document.getElementById('ghost_idle2');
				ghost_3 = document.getElementById('ghost_idle3');
				ghost_4 = document.getElementById('ghost_idle4');
				ghost_5 = document.getElementById('ghost_idle5');
				ghost_6 = document.getElementById('ghost_idle6');
				ghost_7 = document.getElementById('ghost_idle7');
				ghost_8 = document.getElementById('ghost_idle8');
				ghost_9 = document.getElementById('ghost_idle9');

				knightAnims = {
					down: [knightDown1, knightDown2, knightDown3],
					up: [knightUp1, knightUp2, knightUp3],
					left: [knightLeft1, knightLeft2, knightLeft3],
					right: [knightRight1, knightRight2, knightRight3],
					none: [knightDown1, knightDown1, knightDown1],
					idle_up: [knightUp1, knightUp1, knightUp1],
					idle_left: [knightLeft1, knightLeft1, knightLeft1],
					idle_right: [knightRight1, knightRight1, knightRight1]
				};

				ratAnims = {
					up: rat_up,
					down: rat_down,
					left: rat_left,
					right: rat_right,
					none: rat_up
				};

				ghostAnims = {
					idle: [ghost_1, ghost_2, ghost_3, ghost_4, ghost_5, ghost_6, ghost_7, ghost_8, ghost_9]
				};

				player_animations = {
					idle: [player_idle1,player_idle2,player_idle3],
					idle_left: [player_idle_left1,player_idle_left2,player_idle_left3],
					right: [player_run1, player_run2, player_run3, player_run4, player_run5, player_run6],
					up: [player_up1, player_up2, player_up3, player_up4],
					down: [player_down1, player_down2, player_down3, player_down4],
					left: [player_run_left1, player_run_left2, player_run_left3, player_run_left4, player_run_left5, player_run_left6],
					attacking: {
						idle: [player_attack_right1, player_attack_right2, player_attack_right3, player_attack_right4],
						idle_left: [player_attack_left1, player_attack_left2, player_attack_left3, player_attack_left4],
						up: [player_attack_up1, player_attack_up2, player_attack_up3, player_attack_up4],
						down: [player_attack_down1, player_attack_down2, player_attack_down3, player_attack_down4],
						right: [player_attack_right1, player_attack_right2, player_attack_right3, player_attack_right4],
						left: [player_attack_left1, player_attack_left2, player_attack_left3, player_attack_left4]
					}
				};

				melee_animations = {
					default: {
						right: [melee_default_right1, melee_default_right2, melee_default_right3, melee_default_right4, melee_default_right5, melee_default_right6],
						left: [melee_default_left1, melee_default_left2, melee_default_left3, melee_default_left4, melee_default_left5, melee_default_left6],
						up: [melee_default_up1,melee_default_up2,melee_default_up3,melee_default_up4,melee_default_up5,melee_default_up6],
						down: [melee_default_down1, melee_default_down2, melee_default_down3, melee_default_down4, melee_default_down5, melee_default_down6]
					}
				}

				knight_attack_animations = {
					attack: [knightAttack1,knightAttack2,knightAttack3,knightAttack4,knightAttack5,knightAttack6,knightAttack7,knightAttack8,knightAttack9,knightAttack10,knightAttack11,knightAttack12,knightAttack13,knightAttack14],
					stack: knightAttackStack,
					execute: knightAttackExecute
				}

				interval = setInterval(test, 500);


			}



			/* EVENT LISTENERS HERE ONLY */

			function activateMultiplayer() {
				document.getElementById('menuHostId').innerHTML = localData.id;
				document.getElementById('menuHostId').style.color = "green";
				socket.emit('openSwitch', true);
			}

			function selectAbility(string) {

				console.log(string);

			}

			function showSpells() {


				$('#menuSpellBookList').empty();

				for(var i in localData.spellList) {
						//For each elemental / mystical type in spell book.
						var spellType = localData.spellList[i];
						if(spellType.length < 1) {
							//If there are no spells existing for this type of element, return;
							continue;
						}
						for(var j in spellType) {
							//For each spell of the elemental / mystical type,
							var spell = spellType[j];
							var newElem = $('<li class="emptyInventoryItem"><img width="64" height="64" src="' + spell.gfxSrc + '" /></li><div class="add" id=inv_' + spell.name + '"><span id="add_'+ spell.spell_id +'" class="fa fa-plus"></span> </div>');
							//newElem.addEventListener("click", selectAbility, false);
							$('#menuSpellBookList').append(newElem);

							document.getElementById('add_' + spell.spell_id).addEventListener('click', addToHotbar, false);
						}

				}





				menuDefault.style.display = "none";
				menuSpellBook.style.display = "block";
				menuCloseText.innerHTML = "Back";
				menuCloseSpan.className = "fa fa-arrow-left";

				menuClose.removeEventListener('click', toggleMenu, false);
				menuClose.addEventListener('click', showMenuDefault, false);

			}


			function addToHotbar(e) {
				console.log("WORKED: " + e.target.id);
				var spell_id = e.target.id.substring(4);
				var newLi = $('<li><img id="spellImg_' + spell_id + '" width="32" height="32" src="client/img/gfx/abilities/' + spell_id + '.png" /></li>');
				$('#HotbarList').append(newLi);
				var jsNewLi = document.getElementById('spellImg_' + spell_id);
				jsNewLi.addEventListener('click', toggleAbilitySelection, false);
			}

			function deactivateMultiplayer() {
				document.getElementById('menuHostId').innerHTML = "NOT ACTIVE";
				document.getElementById('menuHostId').style.color = "red";
				socket.emit('openSwitch', false);
			}


			function showJoin() {
				menuMultiplayer.style.display = "none";
				menuJoin.style.display = "block";
				menuCloseText.innerHTML = "Back";
				menuCloseSpan.className = "fa fa-arrow-left";

				menuClose.removeEventListener('click', toggleMenu, false);
				menuClose.addEventListener('click', showMenuDefault, false);

			}

			function showHost() {
				menuHost.style.display = "block";
				menuMultiplayer.style.display = "none !important";
				document.getElementById('menuMultiplayer').style.display = "none";
				console.log("MADE IT");
				menuCloseText.innerHTML = "Back";
				menuCloseSpan.className = "fa fa-arrow-left";

				menuClose.removeEventListener('click', toggleMenu, false);
				menuClose.addEventListener('click', showMenuDefault, false);
			}

			function prepInventory() {
				$('#menuInventoryList').empty();
				for(var i in localData.inventory) {
					if(localData.inventory[i].itemName !== "none") {
						var newElem = $("<li><img src='" + localData.inventory[i].itemImg + "' />" + localData.inventory[i].itemName + "</li>");
						$('#menuInventoryList').append(newElem);
					} else {
						var newElem = $('<li class="emptyInventoryItem"></li>');
						$('#menuInventoryList').append(newElem);
					}
				}
				showInventory();
			}

			function showInventory() {
				menuInventory.style.display = "block";
				menuDefault.style.display = "none";
				menuCloseText.innerHTML = "Back";
				menuCloseSpan.className = "fa fa-arrow-left";

				menuClose.removeEventListener('click', toggleMenu, false);
				menuClose.addEventListener('click', showMenuDefault, false);
			}


			function showMultiplayer() {
				console.log("HERESDALDS");
				menuDefault.style.display = "none";
				menuMultiplayer.style.display = "block";
				console.log(menuCloseText);
				menuCloseText.innerHTML = "Back";
				menuCloseSpan.className = "fa fa-arrow-left";

				menuClose.removeEventListener('click', toggleMenu, false);
				menuClose.addEventListener('click', showMenuDefault, false);

			}

			function showMenuDefault() {
				menuDefault.style.display = "block";
				menuMultiplayer.style.display = "none";
				menuHost.style.display = "none";
				menuJoin.style.display = "none";
				menuInventory.style.display = "none";
				menuSpellBook.style.display = "none";
				menuCloseText.innerHTML = "Close";
				menuCloseSpan.className = "fa fa-close";

				menuClose.removeEventListener('click', showMenuDefault, false);
				menuClose.addEventListener('click', toggleMenu, false);
			}

			function toggleMenu() {
				if(!menuToggled) {
					anime({
					  targets: '#menuOverlay',
					  translateX: [
					    { value: -300, duration: 1200 },
					  ],
					  duration: 2000
					});
					menuToggled = true;
				} else {
					menuToggled = false;
					anime({
						targets: '#menuOverlay',
						translateX: [
							{ value: 0, duration: 800 },
						],
						duration: 2000
					});
				}
			}

			function refreshLobbyList() {
				socket.emit("refreshLobbyList", {id: localId});
			}

			function attemptLogin() {
				loginButton.enabled = false;

				var attemptUsername = username_input.value;
				var attemptPassword = password_input.value;
				console.log("HERE");
				socket.emit("attemptLogin", {id: localId, username: attemptUsername, password: attemptPassword});
			}


			/* END EVENT LISTENERS */

			//var music = document.getElementById("backgroundMuisc");
			//music.play(music);
			//music.volume = 0.4;
			var ShopKeeper = {x: "undef", y: "undef", vx: "undef", vy: "undef", size:7, color: "#42d9f4", segement: []};

			var GAME_MAP = [];
			//MAIN

			/* LEGEND */
			//--> postion = [0,0], map_data = {roomLengthX: x, roomLengthY y, };
			function masterKey(position, map_data)
			{

				var middleXIndex = Math.floor((map_data.roomLengthX-1)/2);
				var middleYIndex = Math.floor((map_data.roomLengthY-1)/2);
				if(position[0] == middleXIndex) {
					if(position[1] == middleYIndex) {
						//Center Spawn
						return "forceSpawn";

					}
				}

				if(position[0] == 0)
				{
					if(position[1] == 0) {
						return "forceTL";
					} else if(position[1] == map_data.roomLengthY-1) {
						return "forceBL"
					} else {
						return "forceL";
					}
				}
				if(position[0] == map_data.roomLengthX-1)
				{
					if(position[1] == 0) {
						return "forceTR";
					} else if(position[1] == map_data.roomLengthY-1) {
						return "forceBR";
					} else {
						return "forceR";
					}
				}
				if(position[1] == 0)
				{
					return "forceT";
				}
				if(position[1] == map_data.roomLengthY-1)
				{
					return "forceB";
				}


				return false;
			}


			function generateMap()
			{
				//var randomX  = Math.floor(Math.random()*2 ) +3;
				//var randomY = Math.floor(Math.random()*2 ) +3;
				gameDimensionX = 5; //map segs
				gameDimensionY = 5; //map segs
				var map_data = {roomLengthX: gameDimensionX, roomLengthY: gameDimensionY};
				var generatedShop = false;
				for(var i=0; i<gameDimensionY; i++)
				{
					var tempArray = [];
					for(var j=0; j<gameDimensionX; j++)
					{
						var result = masterKey([j, i], map_data);
						switch (result)
						{
							case false:
								if(!generatedShop) {
									var toSkip = false;
									if(gameDimensionX == j+2 && gameDimensionY == i + 2) {
										var randomSegment = map_PieceShop;
										var spawnLocX = (j*18*32) + (18*32)/2;
										var spawnLocY = (i*18*32) + (18*32)/2;
										ShopKeeper.x = spawnLocX;
										ShopKeeper.y = spawnLocY;
										var type = "Shop";
										ShopKeeper.segment = [i, j];
										generatedShop = true;
										console.log("HAD TO FORCE SHOP");

										toSkip = true;
									}

									if(!toSkip) {
										console.log(GAME_MAP);
										if(typeof GAME_MAP[i] === 'undefined') { console.log("skip");}
										var rand = Math.floor(Math.random()*10) + 1;


										if(rand == 0) {
											var randomSegment = map_Piece0;
											var type = "Random";
										} else if(rand > 1) {
											//Knight room
											var type = "Knight";
											var randomSegment = map_PieceKnight;
										} else if(rand == 1) {
											var randomSegment = map_Piece1;
											var type = "Random";
										} else if(rand == 2) {
											var randomSegment = map_Piece2;
											var type = "Random";
										} else if(rand == 3) {
											var randomSegment = map_Piece3;
											var type = "Random";
										} else if(rand == 4) {
											var randomSegment = map_Piece4;
											var type = "Random";
										} else if(rand == 5) {
											var randomSegment = map_Piece5;
											var type = "Random";
										} else if(rand == 6) {
											var randomSegment = map_Piece6;
											var type = "Random";
										} else if(rand == 7) {
											var randomSegment = map_Piece7;
											var type = "Random";
										} else if(rand == 8) {
											var randomSegment = map_Piece8;
											var type = "Random";
										} else if(rand == 9) {
											//Generate shop
											var randomSegment = map_PieceShop;
											var spawnLocX = (j*18*32) + (18*32)/2;
											var spawnLocY = (i*18*32) + (18*32)/2;
											ShopKeeper.x = spawnLocX;
											ShopKeeper.y = spawnLocY;
											var type = "Shop";
											ShopKeeper.segment = [i, j];
											generatedShop = true;
										} else if(rand == 10) {
											//Knight room
											var type = "Knight";
											var randomSegment = map_PieceKnight;
										} else {
											//generated unexpected number;

										}
									}

									//var map seg messaround with the random gen numbers to get better/more complex map e.g. set 6 to 9  (btw what ever amount you leave empty has a a chance to spawn a shop)
								} else {
									var rand = Math.floor(Math.random()*9) + 1;
									if(rand == 0) {
										var type = "Random";
										var randomSegment = map_Piece0;
									} else if(rand == 1) {
										var type = "Random";
										var randomSegment = map_Piece1;
									} else if(rand == 2) {
										var randomSegment = map_Piece2;
										var type = "Random";
									} else if(rand == 3) {
										var randomSegment = map_Piece3;
										var type = "Random";
									} else if(rand == 4) {
										var randomSegment = map_Piece4;
										var type = "Random";
									} else if(rand == 5) {
										var randomSegment = map_Piece5;
										var type = "Random";
									} else if(rand == 6) {
										var randomSegment = map_Piece6;
										var type = "Random";
									} else if(rand == 7) {
										var randomSegment = map_Piece7;
										var type = "Random";
									} else if(rand == 8) {
										var randomSegment = map_Piece8;
										var type = "Random";
									} else if(rand = 9) {
										//Knight room
										var type = "Knight";
										var randomSegment = map_PieceKnight;
									} else {
										var randomSegment = map_Piece0;
										var type = "Random";
										//generated unexpected number;

									}
								}
								tempArray.push({segment: randomSegment, revealed: false, type: type});
								console.log("Pushed at: " + i + ", " + j);
								break;
							case "forceB":
								var segment = map_PieceB;
								tempArray.push({segment: segment, revealed: false, type:"B"}); // make all
								break;
							case "forceL":
								var segment = map_PieceL;
								tempArray.push({segment: segment, revealed: false, type: "L"});
								break;
							case "forceR":
								var segment = map_PieceR;
								tempArray.push({segment: segment, revealed: false, type: "R"});
								break;
							case "forceT":
								var segment = map_PieceT;
								tempArray.push({segment: segment, revealed: false, type: "T"});
								break;
							case "forceTR":
								var segment = map_PieceTR;
								console.log("force purcshed Top right");
								tempArray.push({segment: segment, revealed: false, type: "TR"});
								break;
							case "forceTL":
								var segment = map_PieceTL;
								tempArray.push({segment: segment, revealed: false, type: "TL"});
								break;
							case "forceBR":
								var segment = map_PieceBR;
								tempArray.push({segment: segment, revealed: false, type: "BR"});
								break;
							case "forceBL":
								var segment = map_PieceBL;
								tempArray.push({segment: segment, revealed: false, type: "BL"});
								break;
							case "forceSpawn":
								var segment = map_PieceSpawn;
								//localData.x = (j*32)/2;
								var locX = (j*(18*32)) + (18*32)/2;
								var locY = (i*(18*32)) + (18*32)/2;
								socket.emit("playerspawn", {x: locX, y: locY});
								console.log("EMITTED");
								//localData.y = (i*32)/2;
								tempArray.push({segment: segment, revealed: false, type: "Spawn"});
								break;

							default:
								break;
						}
					}
					GAME_MAP.push(tempArray);
				}
				console.log("MAP");
				console.log(GAME_MAP);
			}
			//blank = 0
			//wall = 1
			//floor = 2
			//internalPillar = 3
			//var map_PieceSpawn = [
	//			[0,0,0,0,0,0,0,0,0],
	//			[0,1,1,1,1,1,1,1,0],
		//		[0,1,0,0,0,0,0,1,0],
		//		[0,1,0,3,0,3,0,1,0],
//				[0,1,0,0,0,0,0,1,0],
		//		[0,1,0,3,0,3,0,1,0],
	//			[0,1,0,0,0,0,0,1,0],
	//			[0,1,1,1,1,1,1,1,0],
	//			[0,0,0,0,0,0,0,0,0]
		//	];
			//S

			var map_PieceSpawn = [
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,1,5,5,5,5,5,13,9,9,14,5,5,5,5,5,2,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,7,9,9,9,10,9,9,9,9,9,9,10,9,9,9,6,2027],
				[2027,7,9,9,9,17,9,9,9,9,9,9,17,9,9,9,6,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[5,13,9,9,9,9,9,9,10,10,9,9,9,9,9,9,14,5],
				[9,9,9,9,9,9,9,9,10,10,9,9,9,9,9,9,9,9],
				[9,9,9,9,9,9,9,9,16,16,9,9,9,9,9,9,9,9],
				[8,11,9,9,9,9,9,9,16,16,9,9,9,9,9,9,12,8],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,7,9,9,9,10,9,9,9,9,9,9,10,9,9,9,6,2027],
				[2027,7,9,9,9,17,9,9,9,9,9,9,17,9,9,9,6,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,3,8,8,8,8,8,11,9,9,12,8,8,8,8,8,4,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
			];

			//1
			var map_Piece0 = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,09,09,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,16,09,09,09,09,17,09,14,13,09,14,05],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[08,11,09,12,11,09,10,09,09,09,09,10,09,12,11,09,12,08],
				[00,07,09,06,07,09,17,09,09,09,09,16,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			var map_Piece1 = [
				[1,5,5,5,5,5,2,7,9,9,6,1,5,5,5,5,5,2],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[3,8,11,9,12,8,4,7,9,9,6,3,8,11,9,12,8,4],
				[5,5,13,9,14,5,5,13,9,9,14,5,5,13,9,14,5,5],
				[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],
				[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],
				[8,8,11,9,12,8,8,11,9,9,12,8,8,11,9,12,8,8],
				[1,5,13,9,14,5,2,7,9,9,6,1,5,13,9,14,5,2],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[3,8,8,8,8,8,4,7,9,9,6,3,8,8,8,8,8,4],
			];
			var map_Piece2 = [
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,3,8,8,4,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],
				[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],
				[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],
				[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,1,5,5,2,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
			];
			var map_Piece3 = [
				[1,5,5,5,5,5,5,13,9,9,14,5,5,5,5,5,5,2],
				[7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6],
				[7,9,12,8,8,8,8,8,8,8,8,8,8,8,8,11,9,6,6],
				[7,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,6],
				[7,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,6],
				[7,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,6],
				[7,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,6],
				[13,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,14],
				[9,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,9],
				[9,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,9],
				[11,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,12],
				[7,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,6],
				[7,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,6],
				[7,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,6],
				[7,9,6,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,7,9,6],
				[7,9,14,5,5,5,5,5,5,5,5,5,5,5,5,13,9,6],
				[7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6],
				[3,8,8,8,8,8,8,11,9,9,12,8,8,8,8,8,8,4],
			];
			var map_Piece4 = [
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[5,2,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,1,5],
				[9,6,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,7,9],
				[9,6,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,7,9],
				[8,4,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,3,8],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
			];
			var map_Piece5 = [
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[5,2,2027,2027,2027,2027,2027,7,9,9,14,5,5,5,5,5,5,5],
				[9,6,2027,2027,2027,2027,2027,7,9,9,9,9,9,9,9,9,9,9],
				[9,6,2027,2027,2027,2027,2027,7,9,9,9,9,9,9,9,9,9,9],
				[8,4,2027,2027,2027,2027,2027,3,8,8,8,8,8,8,8,8,8,8],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,1,5,5,2,2027,2027,2027,2027,2027,2027,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
			];
			var map_Piece6 = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,09,09,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,16,09,09,09,09,17,09,14,13,09,14,05],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[08,11,09,12,11,09,10,09,09,09,09,10,09,12,11,09,12,08],
				[00,07,09,06,07,09,17,09,09,09,09,16,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			var map_Piece7 = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,09,09,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,16,09,09,09,09,17,09,14,13,09,14,05],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[08,11,09,12,11,09,10,09,09,09,09,10,09,12,11,09,12,08],
				[00,07,09,06,07,09,17,09,09,09,09,16,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			var map_Piece8 = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,09,09,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,16,09,09,09,09,17,09,14,13,09,14,05],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[08,11,09,12,11,09,10,09,09,09,09,10,09,12,11,09,12,08],
				[00,07,09,06,07,09,17,09,09,09,09,16,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			//L
			var map_PieceL = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,14,13,09,09,09,09,09,09,09,09,14,13,09,14,05],
				[00,07,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[00,07,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[00,07,09,12,11,09,09,09,09,09,09,09,09,12,11,09,12,08],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			//R
			var map_PieceR = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,09,09,09,09,09,09,09,14,13,09,06,00],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,06,00],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,06,00],
				[08,11,09,12,11,09,09,09,09,09,09,09,09,12,11,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			//U
			var map_PieceT = [
				[00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,05,05,05,05,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,09,09,09,09,09,09,09,14,13,09,14,05],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[08,11,09,12,11,09,09,09,09,09,09,09,09,12,11,09,12,08],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			//D
			var map_PieceB = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,09,09,09,09,09,09,09,14,13,09,14,05],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[08,11,09,12,11,09,09,09,09,09,09,09,09,12,11,09,12,08],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,08,08,08,08,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00]
			];
			//TR
			var map_PieceTR = [
				[00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,05,05,05,05,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,09,09,09,09,09,09,09,14,13,09,06,00],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,06,00],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,06,00],
				[08,11,09,12,11,09,09,09,09,09,09,09,09,12,11,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			//TL
			var map_PieceTL = [
				[00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,05,05,05,05,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,14,13,09,09,09,09,09,09,09,09,14,13,09,14,05],
				[00,07,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[00,07,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[00,07,09,12,11,09,09,09,09,09,09,09,09,12,11,09,12,08],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			//BL
			var map_PieceBL = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,05,05,05,05,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,14,13,09,09,09,09,09,09,09,09,14,13,09,14,05],
				[00,07,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[00,07,09,09,09,09,10,09,09,09,09,10,09,09,09,09,09,09],
				[00,07,09,12,11,09,09,09,09,09,09,09,09,12,11,09,12,08],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,08,08,08,08,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00]
			];
			//BR
			var map_PieceBR = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,09,09,09,09,09,09,09,14,13,09,06,00],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,06,00],
				[09,09,09,09,09,09,10,09,09,09,09,10,09,09,09,09,06,00],
				[08,11,09,12,11,09,09,09,09,09,09,09,09,12,11,09,06,00],
				[00,07,09,06,07,09,10,09,10,10,09,10,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,08,08,08,08,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00]
			];
			//SH
			var map_PieceKnight = [
				[1,5,5,5,5,5,2,7,9,9,6,1,5,5,5,5,5,2],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[3,8,11,9,12,8,4,7,9,9,6,3,8,11,9,12,8,4],
				[5,5,13,9,14,5,5,13,9,9,14,5,5,13,9,14,5,5],
				[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],
				[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],
				[8,8,11,9,12,8,8,11,9,9,12,8,8,11,9,12,8,8],
				[1,5,13,9,14,5,2,7,9,9,6,1,5,13,9,14,5,2],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[7,9,9,9,9,9,6,7,9,9,6,7,9,9,9,9,9,6],
				[3,8,8,8,8,8,4,7,9,9,6,3,8,8,8,8,8,4],
			];
			//SH
			var map_PieceShop = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,09,09,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,16,09,09,09,09,17,09,14,13,09,14,05],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[08,11,09,12,11,09,10,09,09,09,09,10,09,12,11,09,12,08],
				[00,07,09,06,07,09,17,09,09,09,09,16,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			//BA
			var map_PieceBossA = [
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
				[2027,1,5,5,5,5,5,13,9,9,14,5,5,5,5,5,2,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,7,9,9,9,10,9,9,9,9,9,9,10,9,9,9,6,2027],
				[2027,7,9,9,9,17,9,9,9,9,9,9,17,9,9,9,6,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[5,13,9,9,9,9,9,9,10,10,9,9,9,9,9,9,14,5],
				[9,9,9,9,9,9,9,9,10,10,9,9,9,9,9,9,9,9],
				[9,9,9,9,9,9,9,9,16,16,9,9,9,9,9,9,9,9],
				[8,11,9,9,9,9,9,9,16,16,9,9,9,9,9,9,12,8],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,7,9,9,9,10,9,9,9,9,9,9,10,9,9,9,6,2027],
				[2027,7,9,9,9,17,9,9,9,9,9,9,17,9,9,9,6,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,2027],
				[2027,3,8,8,8,8,8,11,9,9,12,8,8,8,8,8,4,2027],
				[2027,2027,2027,2027,2027,2027,2027,7,9,9,6,2027,2027,2027,2027,2027,2027,2027],
			];
			//BB
			var map_PieceBossB = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,09,09,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,16,09,09,09,09,17,09,14,13,09,14,05],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[08,11,09,12,11,09,10,09,09,09,09,10,09,12,11,09,12,08],
				[00,07,09,06,07,09,17,09,09,09,09,16,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			//BC
			var map_PieceBossC = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,09,09,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,16,09,09,09,09,17,09,14,13,09,14,05],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[08,11,09,12,11,09,10,09,09,09,09,10,09,12,11,09,12,08],
				[00,07,09,06,07,09,17,09,09,09,09,16,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			//BD
			var map_PieceBossD = [
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00],
				[00,01,05,05,05,05,05,13,09,09,14,05,05,05,05,05,02,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,07,09,12,08,08,08,08,08,08,08,08,08,08,11,09,06,00],
				[00,07,09,06,01,05,05,05,05,05,05,05,05,02,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,07,09,10,09,09,09,09,10,09,06,07,09,06,00],
				[05,13,09,14,13,09,16,09,09,09,09,17,09,14,13,09,14,05],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09,09],
				[08,11,09,12,11,09,10,09,09,09,09,10,09,12,11,09,12,08],
				[00,07,09,06,07,09,17,09,09,09,09,16,09,06,07,09,06,00],
				[00,07,09,06,07,09,09,09,09,09,09,09,09,06,07,09,06,00],
				[00,07,09,06,03,08,08,08,08,08,08,08,08,04,07,09,06,00],
				[00,07,09,14,05,05,05,05,05,05,05,05,05,05,13,09,06,00],
				[00,07,09,09,09,09,09,09,09,09,09,09,09,09,09,09,06,00],
				[00,03,08,08,08,08,08,11,09,09,12,08,08,08,08,08,04,00],
				[00,00,00,00,00,00,00,07,09,09,06,00,00,00,00,00,00,00]
			];
			socket.on('refreshedLobbyInfo', function(data) {
				var lobby_pack = data;
				$("#lobbyList").empty();
				for(var i in lobby_pack) {
					var worldId = lobby_pack[i].worldId;
					var worldAmount = lobby_pack[i].worldAmount;

					var newElem = $("<li id='connect_" + worldId + "''><div class='world_id'>World: " + worldId + "</div></li>");
					$("#lobbyList").append(newElem);
					var string = "connect_" + worldId;
				  var theElem = document.getElementById(string);
					theElem.addEventListener('click', joinWorld, false);
				}
			});

			function joinWorld(e) {
				console.log("EVENT: " + e.target.parentElement.id);
				var world = e.target.parentElement.id.substring(8, e.target.parentElement.id.length);
				console.log(world);
				socket.emit("joinWorld", {id: localId, worldId: world});
			}
			socket.on('successfulLogin', function(data) {
				loginOverlay.style.display = "none";
				//worldSwitchOverlay.style.display = "block";
				menuButton.style.display = "block";
				menuOverlay.style.display = "block";
				hotbarImg.style.display = "block";
				hotbar.style.display = "block";
				hotbar.style.left = "42.75rem";
				hotbar.style.top = "68rem";



				preInitialize();
				animate();
			});

			socket.on('receivedConnect', function(data) {
				localId = data.id;
			});

			socket.on('newPosition', function(data) {
				localData = data.player;
				dt = data.dt;
				//console.log(data);
			});

			socket.on('newPositions', function(data) {
				//console.log("Existing Players: ")
				for(var i in data.players) {
					//console.log("Player: " + data.players[i].id);
				}
				local_PLAYER_LIST = [];
				local_PLAYER_LIST = data.players;
			});

			socket.on('newNPCList', function(data) {
				local_KNIGHT_ARRAY = data.knights;
				local_GHOST_ARRAY = data.ghosts;
				local_RAT_ARRAY = data.rats;
				local_ATTACK_ARRAY = data.attacks.player;
				local_KNIGHT_ATTACK_ARRAY = data.attacks.knight;
				local_ABILITIES_ARRAY = data.abilities;
				GAME_MAP = data.map;
				ShopKeeper = data.shopkeeper;
			});
			socket.on("noUsers", function(data) {
				loginButton.enabled = true;
			});



			function isInRevealedSegment(entity) {
				var testX = (entity.x/18)/32;
				var testY = (entity.y/18)/32;
				var xOuterIndex = Math.floor(testX);
				var yOuterIndex = Math.floor(testY);

				return GAME_MAP[yOuterIndex][xOuterIndex].revealed;
			}

			function entityInCurrentSegment(entity) {
				var testX = (entity.x/18)/32;
				var testY = (entity.y/18)/32;
				var xOuterIndex = Math.floor(testX);
				var yOuterIndex = Math.floor(testY);

				return [yOuterIndex, xOuterIndex];
			}

			function animate(){

			//!!!!!!!!!!!!!!!!!!!!!!!!!!!!//
			//ANIMATE FUNCTION BEGINS HERE//
			//~~~~~~~~~~~~~~~~~~~~~~~~~~~//
			//!!!!!!!!!!!!!!!!!!!!!!!!!!!!//
			//~~~~~~~~~~~~~~~~~~~~~~~~~~~//
			//!!!!!!!!!!!!!!!!!!!!!!!!!!!!//
			//~~~~~~~~~~~~~~~~~~~~~~~~~~~//
			//!!!!!!!!!!!!!!!!!!!!!!!!!!!!//
			//~~~~~~~~~~~~~~~~~~~~~~~~~~~//
			//!!!!!!!!!!!!!!!!!!!!!!!!!!!!//
			//~~~~~~~~~~~~~~~~~~~~~~~~~~~//

			 for(var i in GAME_MAP)
			 {

				 for(var j in GAME_MAP[i])
				 {
						 var xLoc = j*18*32;
						 var yLoc = i*18*32;
						 var size = 18*32;
						 if(boxCollides([localData.x, localData.y], [1,1],[xLoc, yLoc],[size,size])) {
							 GAME_MAP[i][j].revealed = true;
						 } else {
							 GAME_MAP[i][j].revealed = false;
						 }
				 }
			 }
/*
			 boxCollides([p.x,p.y],[p.w,p.h],[o.x,o.y],[o.s,o.h]);
							//draw
							ctx.clearRect(0,0,WIDTH, HEIGHT);
*/



				ctx.clearRect(0,0,WIDTH, HEIGHT);
				//map generator
				//uses main key
				//then gets those maps and reads them into the game
						//first peice
				var outerLoopX = 0;
				var outerLoopY = 0;
				for(var i in GAME_MAP)
				{

					for(var j in GAME_MAP[i])
					{


						var testY = (i/18)/32;
						var testX = (j/18)/32;
						var yOuterIndex = Math.floor(i);
						var xOuterIndex = Math.floor(j);
						var newX = xOuterIndex * 18 * 32;
						var newY = yOuterIndex * 18 * 32;
						var segDimensions = [[newX, newY], [18*32, 18*32]];
						var playerScreen = getPlayerScreenHitbox();

						if(boxCollides(playerScreen[0], playerScreen[1], segDimensions[0], segDimensions[1])) {
						//if(entityInCurrentSegment(localData) == [j,i]) {
							var loopX = 0;
							var loopY = 0;
							for(var k in GAME_MAP[i][j].segment)
							{
								for(var l in GAME_MAP[i][j].segment[k])
								{
									var tile = GAME_MAP[i][j].segment[k][l];


									ctx.beginPath();
											//fillStyle command
									var image = false;
											//change to function to return ctx.fillStyle = "#708090"
									if(GAME_MAP[i][j].revealed) {//this one chnages wehter u see everything or nothing yes (true) (in order to turn on fog GAME_MAP[i][j].reveled)
										//console.log(tile);
										switch(tile)
										{
											case 2027:
												var tile = DungeonTiles.blank.src;

												break;

											case 1:
												var tile = DungeonTiles.top_left_corner.src;

												break;

											case 2:
												var tile = DungeonTiles.top_right_corner.src;

												break;

											case 3:
												var tile = DungeonTiles.bottom_left_corner.src;

												break;

											case 4:
												var tile = DungeonTiles.bottom_right_corner.src;

												break;

											case 5:
												var tile = DungeonTiles.wall_top.src;

												break;

											case 6:
												var tile = DungeonTiles.wall_right.src;

												break;

											case 7:
												var tile = DungeonTiles.wall_left.src;

												break;

											case 8:
												var tile = DungeonTiles.wall_bottom.src;

												break;

											case 9:
												var tile = DungeonTiles.tiled_floor.src;

												break;

											case 00:
												var tile = DungeonTiles.blank.src;

												break;

											case 01:
												var tile = DungeonTiles.top_left_corner.src;

												break;

											case 02:
												var tile = DungeonTiles.top_right_corner.src;

												break;

											case 03:
												var tile = DungeonTiles.bottom_left_corner.src;

												break;

											case 04:
												var tile = DungeonTiles.bottom_right_corner.src;

												break;

											case 05:
												var tile = DungeonTiles.wall_top.src;

												break;

											case 06:
												var tile = DungeonTiles.wall_right.src;

												break;

											case 07:
												var tile = DungeonTiles.wall_left.src;

												break;

											case 08:
												var tile = DungeonTiles.wall_bottom.src;

												break;

											case 09:
												var tile = DungeonTiles.tiled_floor.src;

												break;

											case 10:
												var tile = DungeonTiles.internal_wall.src;

												break;

											case 11:
												var tile = DungeonTiles.out_top_right_corner.src;

												break;

											case 12:
												var tile = DungeonTiles.out_top_left_corner.src;

												break;

											case 13:
												var tile = DungeonTiles.out_bottom_right_corner.src;

												break;

											case 14:
												var tile = DungeonTiles.out_bottom_left_corner.src;

												break;

											case 15:
												var tile = DungeonTiles.chest.src;

												break;

											case 16:
												var tile = DungeonTiles.room_pillar1.src;

												break;

											case 17:
												var tile = DungeonTiles.room_pillar2.src;

												break;

											default:
												tile = DungeonTiles.blank.src;
												ctx.fillStyle = "#ffffff";

												break;
										}
										///console.log(tile);
										ctx.drawImage(tile, outerLoopX + loopX - localData.x + (WIDTH/2), outerLoopY + loopY - localData.y + (HEIGHT/2), 32, 32);
										image = true;
									} else {
										ctx.fillStyle = "rgba(0,0,0,0.9)";
									}
								if(!image) {
									ctx.rect(outerLoopX + loopX - localData.x + (WIDTH/2), outerLoopY + loopY - localData.y + (HEIGHT/2), 32, 32);
									ctx.fill();
								}
								//ctx.rect(outerLoopX + loopX - localData.x + (WIDTH/2), outerLoopY + loopY - localData.y + (HEIGHT/2), 32, 32);
								//ctx.fill();
								ctx.closePath();

								loopX += 32;
								}
								loopX = 0;
								loopY += 32;
							}
						}
						outerLoopX += 32*18;
					}
					outerLoopX = 0;
					outerLoopY += 32*18;
				}

				for(var k in local_GHOST_ARRAY) {
					var ghost = local_GHOST_ARRAY[k];

					//Gets index of sgement the rat is currently on.
					var testX = (ghost.x/18)/32;
					var testY = (ghost.y/18)/32;
					var xOuterIndex = Math.floor(testX);
					var yOuterIndex = Math.floor(testY);

					if(GAME_MAP[yOuterIndex][xOuterIndex].revealed) {
						//
						ctx.beginPath();
						//ctx.fillStyle = ghost.color;
						//ctx.arc(ghost.x - localData.x + (WIDTH/2), ghost.y - localData.y + (HEIGHT/2), ghost.size, 0, Math.PI*2);
						//ctx.fill();
						if(ghost.animTick > 8) { ghost.animTick = 0; }
						//console.log("HERE: " + ghost.animTick);
						//console.log(ghost.status);
						ctx.drawImage(ghostAnims.idle[ghost.animTick], ghost.x - localData.x + (WIDTH/2) - 16, ghost.y - localData.y + (HEIGHT/2) - 16);

						ctx.closePath();
					}
				}

				for(var k in local_RAT_ARRAY) {
					var rat = local_RAT_ARRAY[k];


					//Gets index of sgement the rat is currently on.
					var testX = (rat.x/18)/32;
					var testY = (rat.y/18)/32;
					var xOuterIndex = Math.floor(testX);
					var yOuterIndex = Math.floor(testY);

					if(GAME_MAP[yOuterIndex][xOuterIndex].revealed) {

						ctx.beginPath();
						///ctx.fillStyle = rat.color;
						///ctx.arc(rat.x - localData.x + (WIDTH/2), rat.y - localData.y + (HEIGHT/2), rat.size, 0, Math.PI*2);
						///ctx.fill();
						//console.log(rat.direction);
						ctx.drawImage(ratAnims[rat.direction], rat.x - localData.x + (WIDTH/2) - 8, rat.y - localData.y + (HEIGHT/2) - 8);
						ctx.closePath();

						//Health Bar
						ctx.beginPath();
						ctx.fillStyle = "red";
						ctx.rect((rat.x-rat.size - 10) - localData.x + (WIDTH/2), (rat.y - 30) - localData.y + (HEIGHT/2), 40 * (rat.health/rat.maxHealth), 5);
						ctx.fill();
						ctx.closePath();
					}
				}
				///kinght stuff
				for (var i in local_KNIGHT_ARRAY){
					var knight = local_KNIGHT_ARRAY[i];
					if(isInRevealedSegment(knight)) {
						ctx.beginPath();
						console.log(knight.direction);
						ctx.drawImage(knightAnims[knight.direction][knight.animTick], knight.x - localData.x + (WIDTH/2) - 8, knight.y - localData.y + (HEIGHT/2) - 8);
						ctx.closePath();

						//Health Bar
						ctx.beginPath();
						ctx.fillStyle = "red";
						ctx.rect((knight.x-knight.size) - localData.x + (WIDTH/2), (knight.y - 30) - localData.y + (HEIGHT/2), 40 * (knight.health/knight.maxHealth), 5);
						ctx.fill();
						ctx.closePath();
					}
				}
				//Shopkeep entity;
				if(ShopKeeper.x !== "undef") {
					//Gets index of sgement the rat is currently on.
					var testX = (ShopKeeper.x/18)/32;
					var testY = (ShopKeeper.y/18)/32;
					var xOuterIndex = Math.floor(testX);
					var yOuterIndex = Math.floor(testY);

					if(GAME_MAP[yOuterIndex][xOuterIndex].revealed) {

						ctx.beginPath();
						ctx.fillStyle = ShopKeeper.color;
						ctx.arc(ShopKeeper.x - localData.x + (WIDTH/2), ShopKeeper.y - localData.y + (HEIGHT/2), ShopKeeper.size, 0, Math.PI*2);
						ctx.fill();
						ctx.closePath();
					}
				}

				//draw other players
				if(local_PLAYER_LIST) {
					for(var i in local_PLAYER_LIST) {
						if(local_PLAYER_LIST[i].id !== localId) {
							//console.log(local_PLAYER_LIST[i].worldId)
							var otherPlayer = local_PLAYER_LIST[i];
							var testX = (otherPlayer.x/18)/32;
							var testY = (otherPlayer.y/18)/32;
							var xOuterIndex = Math.floor(testX);
							var yOuterIndex = Math.floor(testY);

							if(GAME_MAP[yOuterIndex][xOuterIndex].revealed) {

								if(otherPlayer.direction == "up" || otherPlayer.direction == "down") {
									if(otherPlayer.animTick > 3) {
										otherPlayer.animTick = 0;
										console.log("RESET 1");
									}
								} else if(otherPlayer.direction == "left" || otherPlayer.direction == "right"){
									if(otherPlayer.animTick > 6) {
										otherPlayer.animTick = 0;
										console.log("RESET 2");

									}
								} else if(otherPlayer.direction == "idle" || otherPlayer.direction == "idle_left") {
									if(otherPlayer.animTick > 2) {
										otherPlayer.animTick = 0;
										console.log("RESET 3");

									}
								}

								if(otherPlayer.direction == "idle_down" || otherPlayer.direction == "idle_up") {
									otherPlayer.animTick = 0;
								}
								ctx.beginPath();
								if(otherPlayer.direction !== "idle_up" && otherPlayer.direction !== "idle_down") {
									ctx.drawImage(player_animations[otherPlayer.direction][otherPlayer.animTick], otherPlayer.x - localData.x + (WIDTH/2)-32, otherPlayer.y - localData.y + (HEIGHT/2) - 32, 64, 64);
								} else {
									if(otherPlayer.direction == "idle_up") {
										ctx.drawImage(player_animations["up"][0], otherPlayer.x - localData.x + (WIDTH/2)-32, otherPlayer.y - localData.y + (HEIGHT/2) - 32, 64, 64);
									} else if(otherPlayer.direction == "idle_down" ){
										ctx.drawImage(player_animations["down"][0], otherPlayer.x - localData.x + (WIDTH/2)-32, otherPlayer.y - localData.y + (HEIGHT/2) - 32, 64, 64);
									}
								}
								//ctx.drawImage(player_animations[otherPlayer.direction][otherPlayer.animTick], otherPlayer.x - localData.x + (WIDTH/2)-32,  otherPlayer.y - localData.y + (HEIGHT/2) - 32, 64, 64);
								ctx.closePath();
							}
						}
					}
				}
				//Player.animTick = 0;
				//drawPlayer
				if (localData)
				{
					if(localData.direction == "up" || localData.direction == "down") {
						if(localData.animTick > 3) {
							localData.animTick = 0;
						}
					} else if(localData.direction == "left" || localData.direction == "right"){
						if(localData.animTick > 6) {
							localData.animTick = 0;
						}
					} else if(localData.direction == "idle" || localData.direction == "idle_left") {
						if(localData.animTick > 2) {
							localData.animTick = 0;
						}
					}

					if(localData.currentAction == "attacking") {
						if(localData.animTick > 2) {
							localData.animTick = 0;
						}
					}

					ctx.beginPath();
					//ctx.fillStyle = localData.color;
					//ctx.arc(WIDTH/2, HEIGHT/2, localData.size, 0, Math.PI*2);
					//ctx.fill();
					if(localData.direction !== "idle_up" && localData.direction !== "idle_down") {
						ctx.drawImage(player_animations[localData.direction][localData.animTick], (WIDTH/2)-32, (HEIGHT/2) - 32, 64, 64);
					} else {
						if(localData.direction == "idle_up") {
							ctx.drawImage(player_animations["up"][0], (WIDTH/2)-32, (HEIGHT/2) - 32, 64, 64);
						} else if(localData.direction == "idle_down" ){
							ctx.drawImage(player_animations["down"][0], (WIDTH/2)-32, (HEIGHT/2) - 32, 64, 64);
						}
					}



					//PLAYER HEALTH BAR!
					ctx.beginPath();
					ctx.fillStyle = "red";
					ctx.rect(WIDTH/2 - 20, HEIGHT/2 - 30, 40 * (localData.health/localData.maxHealth), 5);
					ctx.fill();
					ctx.closePath();


					//PLAYER KNIGHT STACKS//





				} else { console.log("no data bob!"); }


				for(var i in local_ATTACK_ARRAY) {
					var attack = local_ATTACK_ARRAY[i];
					if(attack) {
						//If exists..
						var rot = (Math.PI/180) * attack.rotation;
						ctx.beginPath();
						ctx.save();
						ctx.translate(attack.x - localData.x + (WIDTH/2), attack.y - localData.y + (HEIGHT/2));
						ctx.rotate(rot);
						ctx.translate(-(attack.x - localData.x + (WIDTH/2)), -(attack.y - localData.y + (HEIGHT/2)));
						ctx.drawImage(melee_animations[attack.type][attack.direction][attack.animTick], attack.x - localData.x + (WIDTH/2), attack.y - localData.y + (HEIGHT/2), 64, 64);
						ctx.restore();
						ctx.closePath();
					}
				}
				for(var i in local_KNIGHT_ATTACK_ARRAY) {
					var attack = local_KNIGHT_ATTACK_ARRAY[i];
					if(attack) {
						ctx.beginPath();
						ctx.drawImage(knight_attack_animations["attack"][attack.animTick], attack.x - localData.x + (WIDTH/2) - (attack.w / 2), attack.y - localData.y + (HEIGHT/2) - (attack.h / 2), attack.w, attack.h);
						ctx.closePath();
					}
				}
				for(var i in local_ABILITIES_ARRAY) {
					var abilityArray = local_ABILITIES_ARRAY[i];

					for(var j in abilityArray) {
						var ability = abilityArray[j];
						if(i == "dust_mites") {
							ctx.beginPath();
							ctx.save();
							ctx.translate(ability.x + (ability.w/2) - localData.x + (WIDTH/2), ability.y + (ability.h/2) - localData.y + (HEIGHT/2));
							ctx.rotate(ability.rotation);
							ctx.translate(-(ability.x + (ability.w/2) - localData.x + (WIDTH/2)), -(ability.y + (ability.h/2) - localData.y + (HEIGHT/2)));
							ctx.drawImage(AbilityAnims["dust_mites"][ability.animTick], ability.x - localData.x + (WIDTH/2), ability.y - localData.y + (HEIGHT/2), ability.w, ability.h );
							ctx.restore();
							ctx.closePath();

						}
					}
				}






				if(boxCollides([localData.x - localData.size, localData.y - localData.size], [localData.size*2,localData.size*2], [ShopKeeper.x - ShopKeeper.size, ShopKeeper.y - ShopKeeper.size],[ShopKeeper.size *2,ShopKeeper.size*2]))
				{
					interacting.ShopKeeper = true;
				} else {
					interacting.ShopKeeper = false;
					if(displayingShop) {
						displayingShop = false;
						shopOverlay.style.display = "none";
					}
				}
				if(interacting.ShopKeeper) {
					//Background Gui
					ctx.beginPath();
					ctx.fillStyle = "black";
					ctx.rect((localData.x + 50) - localData.x + (WIDTH/2),(localData.y - 50) - localData.y + (HEIGHT/2),(150),(40));
					ctx.fill();
					ctx.closePath();

					//Text Gui
					ctx.beginPath();
					ctx.font = "14px vecna";
					ctx.fillStyle = "white";
					ctx.fillText("Press 'E' to interact", (WIDTH/2) + 60, (HEIGHT/2) - 25);
					ctx.closePath();
				}

				//TestShadow
				var loc = entityInCurrentSegment(localData);
				var yPos = (loc[0]*18*32) + ((18*32)/2);
				var xPos = (loc[1]*18*32) + ((18*32)/2);
				var grd=ctx.createRadialGradient(xPos - localData.x + (WIDTH/2),yPos - localData.y + (HEIGHT/2),1,xPos  - localData.x + (WIDTH/2),yPos  - localData.y + (HEIGHT/2),(18*32)/1.4);
				grd.addColorStop(0,"transparent");
				grd.addColorStop(0.9,"black");
				grd.addColorStop(1,"black");
				ctx.beginPath();
				ctx.fillStyle = grd;
				ctx.arc(xPos - localData.x + (WIDTH/2) , yPos - localData.y + (HEIGHT/2), (18*32)/1.4, 0, Math.PI*2);
				ctx.fill();
				ctx.closePath();


				//Ability Hovers
				if(localData.selectedAbility !== "none") {
					drawSelectedAbility();
				}

				if(hovering[0] !== "none") {
					if(hovering[0] == "rat") {
						var rat = local_RAT_ARRAY[hovering[1]];
						var drawPos = [rat.x - 50, rat.y - 125];
						var drawSize = [100, 100];
						ctx.beginPath();
						ctx.rect(drawPos[0], drawPos[1], drawSize[0], drawSize[1]);
						ctx.fillStyle = "rgba(0,0,0,0.25)";
						ctx.stroke();
						ctx.fill();
						ctx.closePath();
					}
				}

				//GUI STARTED

				ctx.beginPath();
				ctx.drawImage(healthGui, 5, 5, 219, 77);
				ctx.closePath();


				//Player Health Bar
				ctx.beginPath();
				ctx.fillStyle = grdHealth;
				ctx.rect(90, 13, 110*(localData.health/localData.maxHealth), 10);
				ctx.fill();
				ctx.closePath();

				//Player Mana Bar
				ctx.beginPath();
				ctx.fillStyle = grdMana;
				ctx.rect(90, 29, 110*(localData.mana/localData.maxMana), 10);
				ctx.fill();
				ctx.closePath()




				//GUI END







				//END ALL ANIMS

				requestAnimationFrame(animate);

			}

				canvas.addEventListener('mouseup', playerClick, false);

			function drawSelectedAbility() {
				var abilityHover = Hovers[localData.selectedAbility];
				ctx.beginPath();
				if(abilityHover.type == "radial") {
					ctx.arc(mouseX, mouseY, abilityHover.r, 0, Math.PI*2);
					var grdn=ctx.createRadialGradient(mouseX,mouseY,abilityHover.r,mouseX,mouseY,5);
					grdn.addColorStop(0,"red");
					grdn.addColorStop(1,"transparent");
					ctx.fillStyle = grdn;
				} else if(abilityHover.type = "rect") {
					ctx.rect(mouseX - abilityHover.w / 2, mouseY - abilityHover.h / 2, abilityHover.w, abilityHover.h);
					ctx.fillStyle = "blue";
				}


				ctx.fill();
				ctx.closePath();
			}

			function toggleAbilitySelection(e) {
				var ability = e.target.id.substring(9);
				console.log(ability);
				if(ability !== localData.selectedAbility) {

					socket.emit('abilityChange', {ability: ability});
				} else {
					socket.emit('abilityChange', {ability: "none"});
				}
			}

			function castSpell(spell, x, y) {
				if(spell == "soul_passage") {
					return;
				}
				socket.emit('castSpell', {ability: spell, x: x, y: y});
			}

			function getMousePos(canvas, evt) {
			    var rect = canvas.getBoundingClientRect();
			    return {
			      x: evt.clientX - rect.left + (localData.x - (WIDTH/2)),
			      y: evt.clientY - rect.top + (localData.y - (HEIGHT/2))
			    };
			}
			function playerClick(e) {
				var coords = getMousePos(canvas, e);
				console.log(coords.x, coords.y);
				//console.log("HERE");
				if(!localData.castingSpell) {
					socket.emit('playerAttackMelee');
				} else {
					castSpell(localData.selectedAbility, coords.x, coords.y);
				}
			}


			//Default WASD Movement style

			document.onkeydown = function(event) {
				if(event.keyCode == 68) { //d
					if(!lockD) {
						lockD = true;
						socket.emit('keyPress',{inputId:'right', state: true});
					}
				}
				if(event.keyCode == 83) { //s
					if(!lockS) {
						lockS = true;
						socket.emit('keyPress',{inputId:'down', state: true});
					}
				}
				if(event.keyCode == 65) {// a
					if(!lockA) {
						lockA = true;
						socket.emit('keyPress',{inputId:'left', state: true});
					}
				}
				if(event.keyCode == 87) {//w
					if(!lockW) {
						lockW = true;
						socket.emit('keyPress',{inputId:'up', state: true});
					}
				}




			};

			document.onkeyup = function(event) {
				var key = event.keyCode;
				if(event.keyCode == 68) { //d
					socket.emit('keyPress',{inputId:'right', state: false});
					lockD = false;
				}
				if(event.keyCode == 83) { //s
					socket.emit('keyPress',{inputId:'down', state: false});
					lockS = false;
				}
				if(event.keyCode == 65) {// a
					socket.emit('keyPress',{inputId:'left', state: false});
					lockA = false;
				}
				if(event.keyCode == 87) {//w
					socket.emit('keyPress',{inputId:'up', state: false});
					lockW = false;
				}

				if(event.keyCode == 69) {//e
					if(interacting.ShopKeeper) {
						prepShop();
						displayingShop = true;
						console.log("DID IT");
					}
				}

				if(event.keyCode == 49) {//1[Top]
					var spell = getSpellAtSlot(1);
					socket.emit('abilityChange', {ability: spell});
				} else if(event.keyCode == 50) {//2[Top]
					var spell = getSpellAtSlot(2);
					socket.emit('abilityChange', {ability: spell});
				} else if(event.keyCode == 51) {//3[Top]
					var spell = getSpellAtSlot(3);
					socket.emit('abilityChange', {ability: spell});
				} else if(event.keyCode == 52) {//4[Top]
					var spell = getSpellAtSlot(4);
					socket.emit('abilityChange', {ability: spell});
				}
				if(event.keyCode == 27) {
					shopOverlay.style.display = "none";
					displayingShop = false;
				}





				//Spell Related Events
				if(key ==  97 || key == 35) {
					//Numpad 1
					socket.emit("spellKey", {number: 1, id: localId});
				}
			};
			function getSpellAtSlot(slot) {
				var elementArray = Array.from(document.querySelectorAll('#HotBarList>li'));
				var elemId = elementArray[slot-1].lastChild.id;
				var spell_id = elemId.substring(9);


				return spell_id;
			}
			function getPlayerScreenHitbox() {
				return [[localData.x - WIDTH/2, localData.y - HEIGHT/2],[WIDTH,HEIGHT]];

			}

			function preInitialize() {
				generateMap();
				socket.emit("playerReady", {map: GAME_MAP, roomLengthX: gameDimensionX, roomLengthY: gameDimensionY});
				socket.emit("createdShopKeeper", {x:ShopKeeper.x, y:ShopKeeper.y, segement: ShopKeeper.segment});
			}
			function drawBase(color, size, offsetInit) {
				ctx.beginPath();
				ctx.strokeStyle = color;
				ctx.lineWidth = 1;

				ctx.save();
				ctx.translate((x), (y));
				ctx.rotate(offsetInit + offset + testTurn);
				ctx.translate(-(x - localData.x + (WIDTH/2)), -((HEIGHT/2)));
				//^^^offsets to give percpective
				ctx.moveTo(WIDTH/2,HEIGHT/2 - size);
				ctx.lineTo((WIDTH/2) - size, (HEIGHT/2) + size);
				ctx.lineTo((WIDTH/2) + size,(HEIGHT/2) + size);
				ctx.lineTo(WIDTH/2, HEIGHT/2 - size);
				ctx.restore();
				ctx.shadowBlur = 20;
				ctx.shadowColor = color;
				ctx.stroke();
				ctx.closePath();

				ctx.beginPath();
				ctx.save();
				ctx.strokeStyle = color;
				ctx.translate((WIDTH/2), (HEIGHT/2));
				ctx.rotate(offsetInit + offset + testTurn);
				ctx.translate(-(WIDTH/2), -((HEIGHT/2)));
				ctx.moveTo(WIDTH/2, HEIGHT/2 + size);
				ctx.lineTo((WIDTH/2) - size, (HEIGHT/2) - size);
				ctx.lineTo((WIDTH/2) + size, (HEIGHT/2) - size);
				ctx.lineTo(WIDTH/2, HEIGHT/2 + size);
				ctx.restore();
				ctx.shadowBlur = 20;
				ctx.shadowColor = color;
				ctx.stroke();
				ctx.closePath();





				ctx.beginPath();
				ctx.strokeStyle = color;


				ctx.save();
				ctx.translate((WIDTH/2), (HEIGHT/2));
				ctx.rotate(offsetInit + testTurn);
				ctx.translate(-(WIDTH/2), -((HEIGHT/2)));
				ctx.moveTo(WIDTH/2,HEIGHT/2 - size);
				ctx.lineTo((WIDTH/2) - size, (HEIGHT/2) + size);
				ctx.lineTo((WIDTH/2) + size,(HEIGHT/2) + size);
				ctx.lineTo(WIDTH/2, HEIGHT/2 - size);
				ctx.restore();
				ctx.shadowBlur = 20;
				ctx.shadowColor = color;
				ctx.stroke();
				ctx.closePath();

				ctx.beginPath();
				ctx.save();
				ctx.strokeStyle = color;
				ctx.translate((WIDTH/2), (HEIGHT/2));
				ctx.rotate(offsetInit + testTurn);
				ctx.translate(-(WIDTH/2), -((HEIGHT/2)));
				ctx.moveTo(WIDTH/2, HEIGHT/2 + size);
				ctx.lineTo((WIDTH/2) - size, (HEIGHT/2) - size);
				ctx.lineTo((WIDTH/2) + size, (HEIGHT/2) - size);
				ctx.lineTo(WIDTH/2, HEIGHT/2 + size);
				ctx.restore();
				ctx.shadowBlur = 20;
				ctx.shadowColor = color;
				ctx.stroke();
				ctx.closePath();

			}



			/* OVERLAY RELATED FUNCTIONS */

			function shop_switchTo(evt, switchTo) {
			    // Declare all variables
			    var i, tabcontent, tablinks;

			    // Get all elements with class="tabcontent" and hide them
			    tabcontent = document.getElementsByClassName("tabcontent");
			    for (i = 0; i < tabcontent.length; i++) {
			        tabcontent[i].style.display = "none";
			    }

			    // Get all elements with class="tablinks" and remove the class "active"
			    tablinks = document.getElementsByClassName("tablinks");
			    for (i = 0; i < tablinks.length; i++) {
			        tablinks[i].className = tablinks[i].className.replace(" active", "");
			    }

			    // Show the current tab, and add an "active" class to the button that opened the tab
			    document.getElementById(switchTo).style.display = "block";
			    evt.currentTarget.className += " active";
			}



			function prepShop()
			{
				//Empty old spell list.
				$('#spellList').empty();

				for(var i in shopSpellList) {
					var currentSpell = shopSpellList[i];
					var spellName = currentSpell.name;
					var spellCost = currentSpell.cost;
					var spellManaCost = currentSpell.manaCost;

					var newElem = $("<li id='" + spellName + "'><b><span class='title'>" + spellName + "</span><span class='costs'> Cost: $" + spellCost + ", Mana Cost: " + spellManaCost + "</span></b></li>");
					$('#spellList').append(newElem);
				}

				shopOverlay.style.display = "block";
				console.log("WHY");
			}





			document.addEventListener("DOMContentLoaded", start, false);

			function test() {
				if(localData) {
					clearInterval(interval);

				}
			}


			function collides(x, y, r, b, x2, y2, r2, b2) {
					    return !(r <= x2 || x > r2 || b <= y2 || y > b2);
						}
						//Checks collisions for boxes only.
						//pos = item x and y coordinates. eg [0, 0]
						//size = item dimensions (size). eg [50, 50];
						//pos2 = item 2 x and y coordinates.
						//size2 = item 2 dimensions (size).
						function boxCollides(pos, size, pos2, size2) {
						    return collides(pos[0], pos[1], pos[0] + size[0], pos[1] + size[1], pos2[0], pos2[1], pos2[0] + size2[0], pos2[1] + size2[1]);
						}
		</script>
	</body>
</html>
